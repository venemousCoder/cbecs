<%- include('../partials/header') %>

<div class="container" style="padding: 30px 20px; min-height: 60vh;">
    
    <!-- Breadcrumb -->
    <div style="margin-bottom: 20px; font-size: 14px; color: var(--text-muted);">
        <a href="/" style="color: inherit; text-decoration: none;">Home</a> / 
        <a href="/categories" style="color: inherit; text-decoration: none;">Categories</a> / 
        <span style="color: var(--secondary);"><%= listing.name %></span>
    </div>

    <div class="row" style="display: flex; gap: 40px; flex-wrap: wrap; background: white; padding: 30px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);">
        
        <!-- Image Gallery (Single Image for now) -->
        <div class="col" style="flex: 1; min-width: 300px;">
            <div style="width: 100%; height: 400px; border-radius: var(--radius-md); overflow: hidden; border: 1px solid #eee;">
                <img src="<%= listing.image %>" alt="<%= listing.name %>" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
        </div>

        <!-- Product Details -->
        <div class="col" style="flex: 1; min-width: 300px;">
            <div class="type-badge <%= listing.type %>" style="display: inline-block; margin-bottom: 10px;"><%= listing.type.toUpperCase() %></div>
            <h1 style="color: var(--secondary); margin: 0 0 10px 0; font-size: 28px;"><%= listing.name %></h1>
            
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                <span style="font-size: 24px; font-weight: bold; color: var(--primary);">R<%= listing.price.toFixed(2) %></span>
                <% if (listing.type === 'service') { %>
                    <span style="color: var(--text-muted); font-size: 14px;">/ <%= listing.duration %> mins</span>
                <% } %>
            </div>

            <div style="margin-bottom: 25px; padding: 15px; background: #f9fafb; border-radius: var(--radius-sm);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                    <img src="<%= listing.business.logo || '/public/assets/default-business.png' %>" alt="<%= listing.business.name %>" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;">
                    <span style="font-weight: 600; color: var(--secondary);"><%= listing.business.name %></span>
                </div>
                <p style="margin: 0; font-size: 13px; color: var(--text-muted);"><i class="fas fa-map-marker-alt"></i> <%= listing.business.address %></p>
            </div>

            <p style="color: #555; line-height: 1.6; margin-bottom: 30px;">
                <%= listing.description %>
            </p>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px;">
                <form action="/cart/add" method="POST" style="flex: 1; margin: 0;">
                    <input type="hidden" name="listingId" value="<%= listing._id %>">
                    <input type="hidden" name="quantity" value="1">
                    <% if (listing.type === 'product' || listing.type === 'food') { %>
                        <button type="submit" class="auth-btn" style="width: 100%; margin: 0;">Add to Cart</button>
                    <% } else { %>
                        <button type="submit" class="auth-btn" style="width: 100%; margin: 0;">Book Now</button>
                    <% } %>
                </form>
                <button style="width: 50px; border: 1px solid #eee; background: white; border-radius: 4px; cursor: pointer; color: var(--secondary);"><i class="far fa-heart"></i></button>
            </div>

            <% if (listing.stock <= 0 && listing.type !== 'service') { %>
                <p style="color: var(--danger); font-size: 13px; margin-top: 10px;">Out of Stock</p>
            <% } else if (listing.type !== 'service') { %>
                <p style="color: var(--success); font-size: 13px; margin-top: 10px;">In Stock (<%= listing.stock %> available)</p>
            <% } %>
        </div>
    </div>

    <!-- Related Listings -->
    <% if (relatedListings && relatedListings.length > 0) { %>
        <div style="margin-top: 50px;">
            <h3 class="section-title">Similar Listings</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px;">
                <% relatedListings.forEach(item => { %>
                    <a href="/listing/<%= item._id %>" class="product-card" style="text-decoration: none; color: inherit;">
                        <div class="product-img" style="height: 150px;">
                            <img src="<%= item.image %>" alt="<%= item.name %>" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="product-info">
                            <h4 class="product-title" style="font-size: 14px;"><%= item.name %></h4>
                            <div class="product-meta">
                                <span class="price">R<%= item.price.toFixed(2) %></span>
                            </div>
                        </div>
                    </a>
                <% }) %>
            </div>
        </div>
    <% } %>
</div>

<%- include('../partials/footer') %>
