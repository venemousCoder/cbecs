<%- include('../../partials/header') %>

<div class="container" style="padding: 30px 20px; min-height: 60vh;">
    <div class="section-header">
        <h3 class="section-title">Manage SMEs</h3>
        <a href="/admin/dashboard" class="slide-btn" style="background: transparent; color: var(--secondary); border: 1px solid #eee;">Back</a>
    </div>

    <!-- Flash Messages -->
    <% if (locals.success && locals.success.length > 0) { %>
        <div style="color: #155724; background-color: #d4edda; border-color: #c3e6cb; padding: 15px; margin-bottom: 20px; border-radius: var(--radius-sm);">
            <%= success %>
        </div>
    <% } %>

    <div style="background: white; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
            <thead>
                <tr style="background: #f9fafb; text-align: left;">
                    <th style="padding: 15px; font-size: 12px; color: var(--text-muted);">BUSINESS</th>
                    <th style="padding: 15px; font-size: 12px; color: var(--text-muted);">CATEGORY</th>
                    <th style="padding: 15px; font-size: 12px; color: var(--text-muted);">OWNER</th>
                    <th style="padding: 15px; font-size: 12px; color: var(--text-muted);">STATUS</th>
                    <th style="padding: 15px; font-size: 12px; color: var(--text-muted);">ACTION</th>
                </tr>
            </thead>
            <tbody>
                <% businesses.forEach(biz => { %>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 15px;">
                            <strong style="color: var(--secondary);"><%= biz.name %></strong>
                            <div style="font-size: 12px; color: var(--text-muted);"><%= biz.address %></div>
                        </td>
                        <td style="padding: 15px;">
                            <span style="font-size: 12px; padding: 2px 6px; background: #eee; border-radius: 4px;"><%= biz.category.toUpperCase() %></span>
                        </td>
                        <td style="padding: 15px;">
                            <%= biz.owner ? biz.owner.name : 'Unknown' %>
                        </td>
                        <td style="padding: 15px;">
                            <% if (biz.status === 'active') { %>
                                <span style="color: #166534; font-weight: bold; font-size: 12px;">Active</span>
                            <% } else if (biz.status === 'suspended') { %>
                                <span style="color: #991b1b; font-weight: bold; font-size: 12px;">Suspended</span>
                            <% } else { %>
                                <span style="color: #9a3412; font-weight: bold; font-size: 12px;"><%= biz.status %></span>
                            <% } %>
                        </td>
                        <td style="padding: 15px;">
                            <form action="/admin/smes/update-status" method="POST">
                                <input type="hidden" name="businessId" value="<%= biz._id %>">
                                <% if (biz.status === 'active') { %>
                                    <button type="submit" name="status" value="suspended" style="background: #fee2e2; color: #dc2626; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">Suspend</button>
                                <% } else { %>
                                    <button type="submit" name="status" value="active" style="background: #dcfce7; color: #166534; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">Activate</button>
                                <% } %>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</div>

<%- include('../../partials/footer') %>
