<%- include('../partials/header') %>

<div class="container" style="padding: 30px 20px; min-height: 60vh;">
    <h2 class="section-title" style="margin-bottom: 30px;">My Orders</h2>

    <% if (locals.success && locals.success.length > 0) { %>
        <div style="color: #155724; background-color: #d4edda; border-color: #c3e6cb; padding: 15px; margin-bottom: 20px; border-radius: var(--radius-sm);">
            <%= success %>
        </div>
    <% } %>

    <% if (orders.length === 0) { %>
        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);">
            <div style="font-size: 48px; color: var(--text-muted); margin-bottom: 20px;">
                <i class="fas fa-receipt"></i>
            </div>
            <h3 style="color: var(--secondary);">No Orders Yet</h3>
            <p style="color: var(--text-muted); max-width: 400px; margin: 0 auto 30px;">You haven't placed any orders or bookings yet.</p>
            <a href="/categories" class="search-button" style="display: inline-block; text-decoration: none;">Browse Categories</a>
        </div>
    <% } else { %>
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <% orders.forEach(order => { %>
                <div style="background: white; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); overflow: hidden;">
                    <!-- Order Header -->
                    <div style="padding: 15px 20px; background: #f9fafb; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <span style="font-size: 12px; color: var(--text-muted); display: block;">ORDER PLACED</span>
                            <span style="font-weight: 600; color: var(--secondary);"><%= new Date(order.createdAt).toLocaleDateString() %></span>
                        </div>
                        <div>
                            <span style="font-size: 12px; color: var(--text-muted); display: block;">TOTAL</span>
                            <span style="font-weight: 600; color: var(--secondary);">R<%= order.totalAmount.toFixed(2) %></span>
                        </div>
                        <div>
                            <span style="font-size: 12px; color: var(--text-muted); display: block;">ORDER #</span>
                            <span style="font-weight: 600; color: var(--secondary);"><%= order._id.toString().slice(-8).toUpperCase() %></span>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div style="padding: 20px;">
                        <% order.items.forEach(item => { %>
                            <div style="display: flex; gap: 15px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0; last-child: border-bottom: none;">
                                <div style="width: 60px; height: 60px; background: #f9fafb; border-radius: 4px; overflow: hidden; flex-shrink: 0;">
                                    <img src="<%= item.listing ? item.listing.image : 'https://placehold.co/60' %>" alt="<%= item.name %>" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="margin: 0 0 5px 0; font-size: 16px; color: var(--secondary);"><%= item.name %></h4>
                                    <p style="margin: 0 0 5px 0; font-size: 13px; color: var(--text-muted);">Sold by: <%= item.business ? item.business.name : 'Unknown' %></p>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <span style="font-weight: bold; color: var(--primary);">R<%= item.price.toFixed(2) %></span>
                                        <span style="font-size: 12px; color: var(--text-muted);">Qty: <%= item.quantity %></span>
                                        
                                        <!-- Status Badge -->
                                        <span style="font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: bold; text-transform: uppercase; 
                                            <% if (item.status === 'completed') { %> background: #dcfce7; color: #166534; 
                                            <% } else if (item.status === 'cancelled') { %> background: #fee2e2; color: #991b1b;
                                            <% } else { %> background: #ffedd5; color: #9a3412; <% } %>">
                                            <%= item.status %>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } %>
</div>

<%- include('../partials/footer') %>
