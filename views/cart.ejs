<%- include('partials/header') %>

<div class="container" style="padding: 40px 20px; min-height: 60vh;">
    <h2 class="section-title" style="margin-bottom: 30px;">Shopping Cart</h2>

    <% if (locals.success && locals.success.length > 0) { %>
        <div style="color: #155724; background-color: #d4edda; border-color: #c3e6cb; padding: 15px; margin-bottom: 20px; border-radius: var(--radius-sm);">
            <%= success %>
        </div>
    <% } %>
    <% if (locals.error && locals.error.length > 0) { %>
        <div style="color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; padding: 15px; margin-bottom: 20px; border-radius: var(--radius-sm);">
            <%= error %>
        </div>
    <% } %>

    <% if (!items || items.length === 0) { %>
        <div style="text-align: center; padding: 60px 0;">
            <div style="font-size: 48px; color: var(--text-muted); margin-bottom: 20px;">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h3 style="color: var(--secondary);">Your cart is empty</h3>
            <p style="color: var(--text-muted); margin-bottom: 30px;">Looks like you haven't added anything yet.</p>
            <a href="/categories" class="search-button" style="display: inline-block; text-decoration: none;">Start Shopping</a>
        </div>
    <% } else { %>
        <div class="row" style="display: flex; gap: 30px; flex-wrap: wrap;">
            <!-- Cart Items -->
            <div class="col" style="flex: 2; min-width: 300px;">
                <div style="background: white; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); overflow: hidden;">
                    <% items.forEach(item => { %>
                        <div style="display: flex; align-items: center; padding: 20px; border-bottom: 1px solid #eee;">
                            <div style="width: 80px; height: 80px; background: #f9fafb; margin-right: 20px; flex-shrink: 0;">
                                <img src="<%= item.image %>" alt="<%= item.name %>" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div style="flex: 1;">
                                <div class="type-badge <%= item.type %>" style="display: inline-block; font-size: 10px; margin-bottom: 5px; padding: 2px 6px;"><%= item.type ? item.type.toUpperCase() : 'PRODUCT' %></div>
                                <h4 style="margin: 0 0 5px 0; color: var(--secondary);"><%= item.name %></h4>
                                <p style="margin: 0; color: var(--text-muted);">R<%= item.price.toFixed(2) %> x <%= item.qty %></p>
                            </div>
                            <div style="text-align: right;">
                                <p style="font-weight: bold; color: var(--primary); margin-bottom: 10px;">R<%= (item.price * item.qty).toFixed(2) %></p>
                                <form action="/cart/remove/<%= item.listingId %>" method="POST">
                                    <button type="submit" style="background: none; border: none; color: #dc2626; cursor: pointer; font-size: 14px;"><i class="fas fa-trash"></i> Remove</button>
                                </form>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>

            <!-- Summary -->
            <div class="col" style="flex: 1; min-width: 280px;">
                <div style="background: white; padding: 25px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); position: sticky; top: 20px;">
                    <h4 style="margin-top: 0; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Order Summary</h4>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; color: var(--text-muted);">
                        <span>Subtotal</span>
                        <span>R<%= totalPrice.toFixed(2) %></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 25px; font-weight: bold; font-size: 18px; color: var(--secondary);">
                        <span>Total</span>
                        <span>R<%= totalPrice.toFixed(2) %></span>
                    </div>

                    <form action="/checkout" method="POST">
                        <button type="submit" class="auth-btn" style="width: 100%;">Checkout Now</button>
                    </form>
                    <p style="font-size: 12px; color: var(--text-muted); text-align: center; margin-top: 15px;">
                        <i class="fas fa-lock"></i> Secure Checkout
                    </p>
                </div>
            </div>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>
