✦ I have successfully created the login and signup pages, ensuring they are
  responsive, accessible, and visually consistent with your existing design.

  Here is a summary of the changes:
   1. Created `public/css/auth.css`: A dedicated stylesheet for authentication
      pages that uses your existing color palette and variables (e.g., --primary,
      --radius-md) to ensure a cohesive look. It features a centered card layout
      that adapts to different screen sizes.
   2. Created `views/login.ejs`: A clean, user-friendly login form including
      "Remember me" and "Forgot Password" options.
   3. Created `views/signup.ejs`: A registration form with validation attributes
      (e.g., required, minlength) for better accessibility and user feedback.
   4. Updated `views/partials/header.ejs`: Modified the header to accept an
      optional extraCss variable, allowing the auth pages to load their specific
      styles without bloating the main stylesheet.
   5. Updated Controller & Routes: Added getLoginPage and getSignupPage to
      controllers/home.controller.js and registered the /login and /signup routes
      in routes/home.routes.js.

  You can now access these pages at /login and /signup.

   I've created a dedicated signup page for businesses that captures the necessary
  information as outlined in the context.

  Summary of changes:

   1. User Model (`models/user.js`): Defined the Mongoose schema to include the
      role field (supporting 'consumer', 'sme_owner', etc.) and a phone field,
      which is critical for business accounts.
   2. Business Signup View (`views/signup-business.ejs`): Created a new template
      specifically for SMEs. It features:
       * A distinct "Register Your Business" header.
       * A Phone Number field (essential for SMEs).
       * A hidden input to automatically set the role to sme_owner.
       * Links back to the consumer signup and login pages.
   3. Controller & Routes:
       * Added getBusinessSignupPage to controllers/home.controller.js.
       * Registered the route /business/register in routes/home.routes.js.
   4. Navigation Updates:
       * Updated the "Register Your Business (SME)" link in the top bar of the
         header to point to the new page.
       * Added a cross-link in the standard consumer signup page ("Want to sell on
         CBECS? Register as a Business") to ensure users find the right form.

  You can now access the business registration page at /business/register.


✦ I've finalized the Passport authentication setup.

  Summary of actions:
   1. Dependencies: Installed bcryptjs for secure password hashing.
   2. User Model: Updated models/user.js to include a pre-save hook for password
      hashing and a comparePassword method.
   3. Passport Config: Created config/passport.js implementing the Local Strategy
      for authentication.
   4. Controller: Created controllers/auth.controller.js to handle:
       * Registration: Hashes passwords, validates input, and handles role
         assignment (including defaulting to 'consumer' and accepting 'sme_owner'
         from the business form).
       * Login: Authenticates via Passport and redirects users based on their role
         (e.g., SMEs to /sme/dashboard, Consumers to /).
       * Logout: Ends the session and redirects to login.
   5. Middleware: Created middleware/auth.js with ensureAuthenticated to protect
      routes and forwardAuthenticated to redirect logged-in users away from auth
      pages.
   6. Routes: Updated routes/home.routes.js to bind the POST actions for /login,
      /signup, and /business/register, and added the /logout route.
   7. Views: Updated views/signup.ejs and views/signup-business.ejs to display
      validation errors from the server and preserve input values if registration
      fails.

  You can now:
   * Register as a Consumer at /signup.
   * Register as a Business at /business/register.
   * Login at /login and be redirected to your role-specific dashboard.
   * Access protected dashboard routes (currently placeholders) which verify
     authentication.

     ✦ I have successfully implemented the SME onboarding process.

  Summary of changes:

   1. Models: Created models/business.js to store business profile information
      including owner reference, category, address, description, and logo path.
   2. File Uploads: Installed and configured multer in routes/sme.routes.js to
      handle logo uploads, saving them to public/uploads/logos.
   3. Controller: Created controllers/sme.controller.js to handle:
       * Rendering the "Create Business" form.
       * Processing the form submission, including file handling and database
         saving.
       * Rendering the SME Dashboard with a list of the user's businesses.
   4. Views:
       * Created views/sme/create-business.ejs: A responsive form for business
         details and logo upload.
       * Created views/sme/dashboard.ejs: A dashboard displaying the user's
         businesses or a prompt to create one if none exist.
   5. Routes:
       * Created routes/sme.routes.js to define /create-business and /dashboard
         routes, protected by authentication and role checks (sme_owner).
       * Mounted this new router at /sme in routes/index.routes.js.
       * Cleaned up temporary dashboard placeholders in routes/home.routes.js.

  Next Steps:
  You can now log in as an SME owner (or register one via /business/register) and
  navigate to /sme/dashboard. From there, you can click "Create New Business" to
  onboard a new shop.

  ✦ I have implemented the listings system by creating the necessary EJS views that
  correspond to the existing controller logic and routes.

  Summary of changes:
   1. Created `views/sme/listings/index.ejs`:
       * Displays a grid of the SME's listings.
       * Shows images, prices, and stock/duration details.
       * Includes "Edit" and "Delete" actions for each listing.
   2. Created `views/sme/listings/add.ejs`:
       * Provides a form to add new listings.
       * Includes a dynamic dropdown for selecting the Business.
       * Feature: Automatically toggles between "Stock" (for Retail/Food) and
         "Duration" (for Service) input fields based on the selected business
         category using client-side JavaScript.
   3. Created `views/sme/listings/edit.ejs`:
       * Provides a form to edit existing listings.
       * Pre-fills current data.
       * Shows the appropriate fields (Stock vs Duration) based on the listing's
         type (which is fixed upon creation).

  The system now supports:
   * Viewing all listings at /sme/listings
   * Adding a listing at /sme/listings/add (handling the Product vs Service
     distinction)
   * Editing a listing at /sme/listings/:id/edit
   * Deleting a listing via /sme/listings/:id/delete

  You can now start the server (npm start) and navigate to the SME Dashboard to
  manage listings.


✦ I have implemented the "Manage Business" feature.

  Summary of changes:
   1. Updated `routes/sme.routes.js`:
       * Added GET /sme/business/:id/manage to display the management page.
       * Added POST /sme/business/:id/update to handle business profile updates
         (name, address, description, logo).
       * Added POST /sme/business/:id/delete to handle business deletion.
   2. Updated `controllers/sme.controller.js`:
       * Implemented getManageBusinessPage: Fetches the business data and renders
         the view.
       * Implemented updateBusiness: Updates the business details and handles logo
         uploads.
       * Implemented deleteBusiness: Deletes the business (Note: In a production
         app, this should also recursively delete listings, images, orders, etc.,
         but for now it removes the business document).
   3. Created `views/sme/manage-business.ejs`:
       * Displays the "Business Settings" form.
       * Includes "Quick Actions" links to Add/View listings.
       * Includes placeholders for future "Operators" and "Orders" modules, as per
         the system overview in @robot.md.
       * Includes a "Delete Business" button with confirmation.

  The link in the Dashboard (views/sme/dashboard.ejs) that points to
  /sme/business/<%= biz._id %>/manage will now work correctly.

  ✦ I have implemented the public-facing browsing and searching system.

  Summary of Changes:

   1. Created `controllers/consumer.controller.js`:
       * getAllCategories: Renders the main category selection page.
       * getCategoryListings: Fetches and renders listings filtered by type
         ('retail'/'product', 'service', 'food').
       * getListingDetails: Fetches a specific listing by ID, showing details and
         related items.
       * searchListings: Implements a case-insensitive regex search on listing
         names and descriptions.

   2. Updated `routes/home.routes.js`:
       * Added routes: /categories, /categories/:id, /listing/:id, and /search
         pointing to the new consumer controller.

   3. Created Views:
       * views/categories/index.ejs: A clean grid layout displaying the three main
         business categories.
       * views/categories/show.ejs: Displays a grid of listings for a specific
         category.
       * views/listings/show.ejs: A detailed product/service page with image,
         description, price, stock status, and placeholder "Add to Cart"/"Book Now"
         buttons.
       * views/search.ejs: Displays search results or a "No Results" message.

  You can now browse the platform as a guest, view products, and search for items
  without needing to log in

  ✦ I have implemented the persistent Cart and Checkout system.

  Summary of Changes:

   1. Created `models/order.js`: A schema to store order details (items, total
      amount, status).
   2. Created `controllers/cart.controller.js`:
       * addToCart: Adds items to req.session.cart, handling quantity updates for
         existing items.
       * getCart: Renders the cart view.
       * removeFromCart: Removes items and updates totals.
       * postCheckout: Checks authentication, creates an Order record, clears the
         session cart, and redirects.
   3. Created `routes/cart.routes.js`: Defined routes for /cart (GET), /cart/add
      (POST), /cart/remove/:id (POST), and /checkout (POST, protected).
   4. Updated `routes/index.routes.js`: Mounted the cart routes.
   5. Created `views/cart.ejs`: Displays the cart items, image, price, quantity,
      subtotal, and a checkout button.
   6. Updated `views/listings/show.ejs`: "Add to Cart" and "Book Now" buttons now
      function as forms submitting to /cart/add.
   7. Updated `views/partials/header.ejs`:
       * The Cart icon now shows a dynamic badge count based on the session.
       * Authentication links (Sign In / Logout / Dashboard) are now dynamic based
         on login status.
   8. Updated `app.js`: Added res.locals.cart = req.session.cart so the header can
      access cart data globally.

  The system now supports adding items to the cart as a guest, viewing the cart,
  and requiring login only upon checkout. Checkout creates a persistent order in
  the database.

  ✦ I have implemented the full Order Management system for both consumers and SMEs.

  Summary of Changes:

   1. Updated `models/order.js`:
       * Modified the schema to store business ID and status at the item level.
         This allows a single order to contain items from multiple SMEs, where each
         SME can manage the status of their own items independently.

   2. Updated `controllers/cart.controller.js`:
       * Updated addToCart to save the businessId in the session cart.
       * Updated postCheckout to populate the new item-level fields (business,
         status) when saving the order.

   3. Consumer Order History:
       * Created controllers/order.controller.js: Added getConsumerOrders to fetch
         and display orders for the logged-in user.
       * Created views/orders/index.ejs: A clean, card-based layout showing order
         history with item details and status badges.
       * Updated routes/index.routes.js: Added /orders and /bookings routes.

   4. SME Order Dashboard:
       * Updated controllers/sme.controller.js:
           * Added getSmeOrders: Fetches orders containing items belonging to the
             SME's businesses. It filters the items so the SME only sees what they
             sold.
           * Added updateOrderItemStatus: Allows SMEs to change the status of
             individual items (Pending -> Processing -> Completed) via a dropdown.
       * Created views/sme/orders/index.ejs: A dashboard view for SMEs to see
         incoming orders, customer details, and manage item status.
       * Updated routes/sme.routes.js: Added routes for viewing orders and updating
         status.

   5. UI/UX Integration:
       * Updated views/sme/dashboard.ejs: Added a "Orders" button to the header for
         quick access.
       * Updated views/sme/manage-business.ejs: Activated the "Orders" link in the
         sidebar/module list.

  The system is now fully functional for the "Order" lifecycle: Consumer adds to
  cart -> Checkout -> Order Saved -> Consumer sees history -> SME sees order in
  dashboard -> SME updates status -> Consumer sees updated status.

  ✦ I have implemented the Operator system creation workflow.

  Summary of Changes:

   1. Updated Models:
       * User model: Added operatorOf field (ObjectId ref to Business).
       * Business model: Added operators array (ObjectId ref to User).
   2. Created `controllers/operator.controller.js`:
       * getAddOperatorPage: Renders the form.
       * createOperator: Creates a new user with role operator, links them to the
         business, and updates the business's operators array. Enforces the rule:
         Retail businesses can only have 1 operator.
   3. Updated Routes:
       * routes/sme.routes.js: Imported operator.controller and added routes for
         /business/:id/operators/add (GET & POST).
       * Removed temporary routes/operator.routes.js to keep architecture clean.
   4. Created View:
       * views/sme/operators/add.ejs: Form to register a new operator directly
         under a specific business.
   5. Updated UI:
       * views/sme/manage-business.ejs: The "Operators" link now points to the "Add
         Operator" page.

  SME Owners can now create operators for their specific businesses. The next
  logical step would be to create the Operator Dashboard so these new users can
  actually log in and see/manage their assigned tasks.

  ✦ I have implemented the full Operator system.

  Summary of Changes:

   1. Updated `controllers/operator.controller.js`:
       * Added getOperatorDashboard: Fetches orders relevant to the operator's
         assigned business and renders the dashboard.
       * Added operatorUpdateStatus: Allows operators to update the status of items
         in their queue (security check: ensures item belongs to their business).
       * Added getOperatorsList: Logic for SME Owners to view all operators for a
         specific business.
       * Added removeOperator: Logic for SME Owners to remove (delete) an operator.

   2. Created `routes/operator.routes.js`:
       * Defined routes for the operator dashboard (/operator/dashboard) and status
         updates (/operator/orders/update-status).
       * These routes are protected by ensureRole('operator').

   3. Updated `routes/sme.routes.js`:
       * Added routes for SME Owners to list operators (GET
         /business/:id/operators) and remove them (POST
         /business/:id/operators/remove).

   4. Updated `routes/index.routes.js`:
       * Mounted the new operator router at /operator.

   5. Created Views:
       * views/operator/dashboard.ejs: A dedicated dashboard for operators showing
         their specific business's orders/tasks with status controls.
       * views/sme/operators/index.ejs: A list view for SME Owners to see and
         manage their operators.

   6. Updated UI:
       * views/sme/manage-business.ejs: The "Operators" link now correctly points
         to the operator list.

  The system now supports the complete lifecycle: SME creates operator -> Operator
  logs in -> Operator manages orders -> SME can remove operator

  ✦ I have implemented the Admin Dashboard and its core management modules.

  Summary of Changes:

   1. Created `models/category.js`: A schema for dynamic category management (Name,
      Slug, Icon, Description).
   2. Updated `models/business.js`: Added a status field (default: 'active') to
      allow admins to suspend/activate businesses.
   3. Created `controllers/admin.controller.js`:
       * getDashboard: Displays key statistics (User/Business/Listing counts) and
         recent registrations.
       * getSMEs & updateSMEStatus: Lists all SMEs and allows toggling their status
         between 'Active' and 'Suspended'.
       * getListings & deleteListing: Lists all platform listings and allows admin
         deletion (moderation).
       * getUsers: Lists all registered users and their roles.
       * getCategories & createCategory/deleteCategory: CRUD for managing system
         categories.
   4. Created `routes/admin.routes.js`: Defined the admin endpoints, protected by
      ensureRole('admin').
   5. Updated `routes/index.routes.js`: Mounted the admin router at /admin.
   6. Created Views:
       * views/admin/dashboard.ejs: Main overview.
       * views/admin/smes/index.ejs: Table view for SME management.
       * views/admin/listings/index.ejs: Grid view for listing moderation.
       * views/admin/users/index.ejs: List of all users.
       * views/admin/categories/index.ejs: Interface to add and remove categories.

  The Admin Dashboard is now accessible at /admin/dashboard (requires a user with
  role: 'admin'). You can use this to moderate content, manage business access, and
  configure categories.

  ✦ I have completed the task. The category links on the home page are now dynamic
  and active, fetching data from the database. Additionally, both SME owners and
  Operators must now select a category when adding a new listing.

  Summary of Changes:

   1. Models:
       * `models/listing.js`: Added a required category field (referencing the
         Category model).
       * `models/category.js`: Added a required type field (enum: retail, service,
         food) to support the platform's hybrid nature.

   2. Controllers:
       * `controllers/home.controller.js`: Removed hardcoded categories; now
         fetches them dynamically from the database for the home page.
       * `controllers/consumer.controller.js`: Updated getCategoryListings to look
         up categories by slug and then find listings by the category ID.
       * `controllers/listing.controller.js` &
         `controllers/operator.controller.js`: Updated the "Add Listing" logic to
         fetch available categories for the form and save the selected category ID
         when a listing is created.

   3. Views:
       * `views/home.ejs`: Updated the Sidebar and Circle Grid to use dynamic
         category data and link to /category/:slug.
       * `views/categories/index.ejs`: Updated to use dynamic links
         (/category/:slug) and descriptions.
       * `views/sme/listings/add.ejs` & `views/operator/listings/add.ejs`: Added a
         "Category" dropdown menu to the "Add Listing" forms.

   4. Routes:
       * `routes/home.routes.js`: standardized the route for single category views
         to /category/:id (where :id is the slug).

  Note: Since the home page and category pages now rely on database content, ensure
  you have created some Category documents in your database (with slugs like
  'retail', 'services', 'food' to match the Hero Slider links) for the site to
  function correctly.

  ✦ I've implemented the functionality for consumers to view a shop's details and its
  listings.

  Here is a summary of the changes:
   1. Controller Logic: Added getShopDetails to controllers/consumer.controller.js.
      This fetches the Business by ID and finds all Listing items associated with
      that business.
   2. Route: Added a new route GET /shop/:id in routes/home.routes.js that maps to
      the new controller method.
   3. View: Created views/shop/show.ejs. This page displays the shop's logo, name,
      description, address, and a grid of all their active listings.
   4. Integration: Updated views/listings/show.ejs so that clicking the business
      name or logo on a product page now takes the user to that shop's profile.

  You can now navigate to /shop/<business_id> to see the new shop page, or click on
  the shop name from any listing details page.